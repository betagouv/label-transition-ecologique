(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[218],{80874:function(e,t,n){"use strict";n.d(t,{O:function(){return r}});var i=n(53248);let r=(0,i.eI)("https://rlarzronkgoyvtdkltqy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJsYXJ6cm9ua2dveXZ0ZGtsdHF5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2NDQ0MjM3NTcsImV4cCI6MTk1OTk5OTc1N30.Ciu6o-2Tnjm0yY7UuYcUeZNZbRGDOIQ4I6kA6hwkSuw",{db:{schema:"public"}})},49303:function(e,t,n){"use strict";n.d(t,{LE:function(){return i},GD:function(){return r}});let i=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9 ]/g,"").trim().toLowerCase().split(" ").filter(e=>e.length>0).join("-"),r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e?e.toLocaleString(void 0,{maximumFractionDigits:t}):"0"}},44218:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return D}});var i=n(26705),r=n(20955),l=n(3190);function o(e,t){return Object.freeze({...e,...t})}let c=(0,r.createContext)(null),u=c.Provider;function a(){let e=(0,r.useContext)(c);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function s(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function f(e,t){return null==t?function(t,n){let i=(0,r.useRef)();return i.current||(i.current=e(t,n)),i}:function(n,i){let l=(0,r.useRef)();l.current||(l.current=e(n,i));let o=(0,r.useRef)(n),{instance:c}=l.current;return(0,r.useEffect)(function(){o.current!==n&&(t(c,n,o.current),o.current=n)},[c,n,i]),l}}function p(e,t){let n=(0,r.useRef)();(0,r.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function d(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}function v(e,t){var n;let i=f(e,t);return n=function(e){var t;let n=a(),l=i(d(e,n),n);return p(l.current,e.eventHandlers),t=l.current,(0,r.useEffect)(function(){let e=n.layerContainer??n.map;return e.addLayer(t.instance),function(){n.layerContainer?.removeLayer(t.instance),n.map.removeLayer(t.instance)}},[n,t]),function(e,t){let n=(0,r.useRef)();(0,r.useEffect)(function(){if(t.pathOptions!==n.current){let i=t.pathOptions??{};e.instance.setStyle(i),n.current=i}},[e,t])}(l.current,e),l},(0,r.forwardRef)(function(e,t){let{instance:i,context:l}=n(e).current;return(0,r.useImperativeHandle)(t,()=>i),null==e.children?null:r.createElement(u,{value:l},e.children)})}var h=n(30447);let m=v(function({children:e,...t},n){let i=new h.FeatureGroup([],t);return s(i,o(n,{layerContainer:i,overlayContainer:i}))}),y=v(function({data:e,...t},n){let i=new h.GeoJSON(e,t);return s(i,o(n,{overlayContainer:i}))},function(e,t,n){t.style!==n.style&&(null==t.style?e.resetStyle():e.setStyle(t.style))}),g=function(e,t){var n;let i=f(e);return n=function(e,n){let l=a(),o=i(d(e,l),l);return function(e,t){let n=(0,r.useRef)(t);(0,r.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}(l.map,e.attribution),p(o.current,e.eventHandlers),t(o.current,l,e,n),o},(0,r.forwardRef)(function(e,t){let[i,o]=(0,r.useState)(!1),{instance:c}=n(e,o).current;(0,r.useImperativeHandle)(t,()=>c),(0,r.useEffect)(function(){i&&c.update()},[c,i,e.children]);let u=c._contentNode;return u?(0,l.createPortal)(e.children,u):null})}(function(e,t){let n=new h.Tooltip(e,t.overlayContainer);return s(n,t)},function(e,t,{position:n},i){(0,r.useEffect)(function(){let r=t.overlayContainer;if(null==r)return;let{instance:l}=e,o=e=>{e.tooltip===l&&(null!=n&&l.setLatLng(n),l.update(),i(!0))},c=e=>{e.tooltip===l&&i(!1)};return r.on({tooltipopen:o,tooltipclose:c}),r.bindTooltip(l),function(){r.off({tooltipopen:o,tooltipclose:c}),null!=r._map&&r.unbindTooltip()}},[e,t,i,n])});var _=n(24033),w=n(49303),b=e=>{let{collectivite:t}=e,n=(0,_.useRouter)(),r=t.geojson,l=t.labellisee?{fillColor:"#4D75AC",fillOpacity:.7,color:"#4D75AC",weight:1.5}:{fillColor:"#9E9E9E",fillOpacity:.7,color:"#9E9E9E",weight:1.5};return(0,i.jsxs)(m,{children:[(0,i.jsx)(y,{data:r,style:l,eventHandlers:{click:()=>{var e;n.push("/collectivite/".concat(t.code_siren_insee,"/").concat((0,w.LE)(null!==(e=t.nom)&&void 0!==e?e:"")))}}}),(0,i.jsx)(g,{children:(0,i.jsx)("p",{className:"mb-0",children:t.nom})})]},t.collectivite_id)},I=e=>{let{region:t}=e,n=t.geojson;return(0,i.jsx)(m,{children:(0,i.jsx)(y,{data:n,style:{fillOpacity:1,fillColor:"#fff",color:"#000",weight:1}})},t.insee)};function C(){return(C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}let E=(0,r.forwardRef)(function({bounds:e,boundsOptions:t,center:n,children:i,className:l,id:o,placeholder:c,style:a,whenReady:s,zoom:f,...p},d){let[v]=(0,r.useState)({className:l,id:o,style:a}),[m,y]=(0,r.useState)(null);(0,r.useImperativeHandle)(d,()=>m?.map??null,[m]);let g=(0,r.useCallback)(i=>{if(null!==i&&null===m){let r=new h.Map(i,p);null!=n&&null!=f?r.setView(n,f):null!=e&&r.fitBounds(e,t),null!=s&&r.whenReady(s),y(Object.freeze({__version:1,map:r}))}},[]);(0,r.useEffect)(()=>()=>{m?.map.remove()},[m]);let _=m?r.createElement(u,{value:m},i):c??null;return r.createElement("div",C({},v,{ref:g}),_)});function O(e,t){var n,i=h.DomUtil.create("div",e,document.body),r=function(e,t){for(var n,i=/url\(['"]?([^"']*?)['"]?\)/gi,r=[],l=i.exec(e);l;)r.push(t?(n=l[1]).substr(n.lastIndexOf("/")+1):l[1]),l=i.exec(e);return r}((n=S(i,"background-image"))&&"none"!==n?n:S(i,"cursor"),t),l=x(i,"width"),o=x(i,"height"),c=x(i,"margin-left"),u=x(i,"margin-top");return i.parentNode.removeChild(i),{Url:r[0],RetinaUrl:r[1],Size:[l,o],Anchor:[-c,-u]}}function j(e){var t=h.DomUtil.create("div",e,document.body),n=x(t,"margin-left"),i=x(t,"margin-top");return t.parentNode.removeChild(t),{Anchor:[n,i]}}function x(e,t){return parseInt(S(e,t),10)}function S(e,t){return h.DomUtil.getStyle(e,t)||h.DomUtil.getStyle(e,t.replace(/-(\w)/g,function(e,t){return t.toUpperCase()}))}function z(){let e=a().map;return window.map=e,null}n(99722),n(30396),h.Icon.Default.mergeOptions({iconUrl:null,iconRetinaUrl:null,shadowUrl:null,iconSize:null,iconAnchor:null,popupAnchor:null,tooltipAnchor:null,shadowSize:null,classNamePrefix:"leaflet-default-icon-"}),h.Icon.Default.include({_needsInit:!0,_getIconUrl:function(e){var t=this.options.imagePath||h.Icon.Default.imagePath||"";return this._needsInit&&this._initializeOptions(t),t+h.Icon.prototype._getIconUrl.call(this,e)},_initializeOptions:function(e){this._setOptions("icon",O,e),this._setOptions("shadow",O,e),this._setOptions("popup",j),this._setOptions("tooltip",j),this._needsInit=!1},_setOptions:function(e,t,n){var i=this.options,r=t(i.classNamePrefix+e,n);for(var l in r)i[e+l]=i[e+l]||r[l]}}),n(97217);var N=e=>{let{children:t,style:n}=e,[l,o]=(0,r.useState)(window.innerWidth);return(0,r.useEffect)(()=>(window.addEventListener("resize",()=>o(window.innerWidth)),()=>window.removeEventListener("resize",()=>o(window.innerWidth))),[]),(0,i.jsxs)(E,{center:[46.3,2.3],zoom:l&&l<500?4.6:l&&(l<768||l>=1024&&l<1280)?5.7:6,zoomSnap:.1,scrollWheelZoom:!1,style:{width:"100%",background:"#fff",...n},className:"aspect-square",children:[(0,i.jsx)(z,{}),t]})},k=n(80874),R=n(42333);let U=()=>(0,R.ZP)("site_labellisation-carte-engagees",async()=>{let{error:e,data:t}=await k.O.from("site_labellisation").select("*, geojson").eq("engagee",!0);if(e)throw Error("site_labellisation-carte-engagees");let{error:n,data:i}=await k.O.from("site_region").select("*, geojson");if(n)throw Error("site_labellisation-carte-engagees");return t&&i?{collectivites:t,regions:i}:null});var D=e=>{let{filtre:t,etoiles:n}=e,{data:l}=U(),[o,c]=(0,r.useState)(l),u=e=>e.sort((e,t)=>"syndicat"===e.type_collectivite&&("EPCI"===t.type_collectivite||"commune"===t.type_collectivite)||"EPCI"===e.type_collectivite&&"commune"===t.type_collectivite?-1:"commune"===e.type_collectivite&&("EPCI"===t.type_collectivite||"syndicat"===t.type_collectivite)||"EPCI"===e.type_collectivite&&"syndicat"===t.type_collectivite?1:0);return((0,r.useEffect)(()=>{c(l?{collectivites:u(l.collectivites),regions:l.regions}:l)},[l]),(0,r.useEffect)(()=>{if(l){let e=l.collectivites;"labellisees_cae"===t&&(e=e.filter(e=>e.cae_etoiles&&n.includes(e.cae_etoiles))),"labellisees_eci"===t&&(e=e.filter(e=>e.eci_etoiles&&n.includes(e.eci_etoiles))),"cot"===t&&(e=e.filter(e=>!0===e.cot)),c(t=>t?{...t,collectivites:u(e)}:t)}},[t,n,l]),o)?(0,i.jsxs)(N,{children:[o.regions.filter(e=>!!e.geojson).map(e=>(0,i.jsx)(I,{region:e},e.insee)),o.collectivites.filter(e=>!!e.geojson).map(e=>(0,i.jsx)(b,{collectivite:e},e.collectivite_id))]}):null}},97217:function(){},30396:function(){},99722:function(){},24033:function(e,t,n){e.exports=n(68165)}}]);