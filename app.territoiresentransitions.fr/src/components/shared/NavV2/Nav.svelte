<script>
    /**
     * Top navigation bar
     */
    import {onMount} from 'svelte'
    import {testUIVisibility} from '../../../api/currentEnvironment'
    import {getCurrentEpciId} from '../../../api/currentEpci'

    export let segment // Type string. Typing this variable makes sapper crash.
    export let slot

    let showTestNavigation = false
    let epciId = ''

    $: isLogged = segment && segment !== 'connexion'

    /**
     * Hard navigate to the test epci in order to clear Sapper state.
     */
    const handleTest = (_) => {
        window.location.href = 'fiches/?epci_id=test'
    }

    onMount(async () => {
        showTestNavigation = testUIVisibility()
        try {
            epciId = getCurrentEpciId()
        } catch (e) {
            // not signed in, it's fine
        }
    })
</script>

<div class="fr-header__tools">
    <div class="fr-header__tools-links">
        <ul class="fr-links-group">
            {#if isLogged}
                {#if epciId}
                    <li>
                        <a class="fr-link" href="fiches/?epci_id={epciId}">Mon plan d'actions</a>
                    </li>
                    <li>
                        <a class="fr-link" href="actions_referentiels/?epci_id={epciId}">Référentiels</a>
                    </li>
                    <li>
                        <a class="fr-link" href="indicateurs/?epci_id={epciId}">Indicateurs</a>
                    </li>
                {/if}
                <li>
                    <a class="fr-link fr-fi-account-line" href="auth/signout/">Déconnexion</a>
                </li>
            {:else}
                {#if !segment || segment === 'connexion' }
                    <li>
                        <a class="fr-link fr-fi-account-line" href="auth/signin/?epci_id={epciId}">Se connecter</a>
                    </li>
                {/if}
            {/if}
        </ul>
    </div>
</div>